<!DOCTYPE html>
<html>
<head>
    <title>Cascading Selects</title>
    <meta "name"="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link href="css/jquery.mobile-1.3.0.min.css" rel="stylesheet" type="text/css" />
    <script src="js/vendor/jqm/jquery-1.8.3.min.js" type="text/javascript"></script>
    <script src="js/vendor/jqm/jquery.mobile-1.3.0.min.js" type="text/javascript"></script>
    <script src="lib/handlebars.js" type="text/javascript"></script>
    <script src="js/utils.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            var c;
            var o = {
                "name": "root",
                "children": [{
                    "name": "level1.1",
                    "children": [{
                        "name": "level2.1",
                        "children": [{
                            "name": "level3.1"
                        }, {
                            "name": "level3.2"
                        }]
                    }, {
                        "name": "level2.2",
                        "children": [{
                            "name": "level3.3"
                        }, {
                            "name": "level3.4"
                        }]
                    }]
                }]
            };

            var response = { "name": "root",
                "children": [
  {
      "name": "Item 1",
      "children": [{
          "name": "Item 1.1",
          "children": null
      }, {
          "name": "Item 1.2",
          "children": [{
              "name": "Item 1.2.1",
              "children": null
          }, {
              "name": "Item 1.2.2",
              "children": null
          }]
      }]
  },
  {
      "name": "Item 2",
      "children": [{
          "name": "Item 2.1",
          "children": null
      }]
  }
]
            }
                       ;


            var response1 = [
  {
      "name": "Item 1",
      "children": [{
          "name": "Item 1.1",
          "children": null
      }, {
          "name": "Item 1.2",
          "children": [{
              "name": "Item 1.2.1",
              "children": null
          }, {
              "name": "Item 1.2.2",
              "children": null
          }]
      }]
  },
  {
      "name": "Item 2",
      "children": [{
          "name": "Item 2.1",
          "children": null
      }]
  }
];











            //            var response = [
            //  {
            //      "name": "Item 1",
            //      "children": [{
            //          "name": "Item 1.1",
            //          "children": null
            //      }, {
            //          "name": "Item 1.2",
            //          "children": [{
            //              "name": "Item 1.2.1",
            //              "children": null
            //          }, {
            //              "name": "Item 1.2.2",
            //              "children": null
            //          }]
            //      }]
            //  },
            //  {
            //      "name": "Item 2",
            //      "children": [{
            //          "name": "Item 2.1",
            //          "children": null
            //      }]
            //  }
            //]
            //           
            //           ;



            var audaciousFn;
            Handlebars.registerHelper('recursive', function (children, options) {
                var out = '';
                if (options.fn !== undefined) {
                    audaciousFn = options.fn;
                }
                children.forEach(function (child) {
                    out = out + audaciousFn(child);
                });
                return out;
            });

            $("#btn").click(function () {

                $("#convert").trigger("click");
                var cc = { "name": "root", "children": c };
                console.log(cc);



                var source = $("#employee-li-tpl").html();
                var template = Handlebars.compile(source);
                var html = template(cc);
                $("#context").append(html)
                $('#context').find('div[data-role=collapsible]').collapsible();
                $("input[type='checkbox']").checkboxradio();



                $("input[type='checkbox']").each(function () {
                    $(this).change(function () {
                        console.log("checkbox");
                        var self = this;
                        $("input[type='checkbox']").each(function () {
                            if (self !== this) {
                                $(this).attr("checked", false).checkboxradio("refresh");
                            }
                        })



                    })
                })


                //console.log(html);
                //$("#clParent")
            })



            $("#check").click(function () {
                var array = [];
                $("input[type='checkbox']").each(function () {
                    if ($(this).is(":checked")) {
                        array.push(this);
                    }
                })


                console.log($(array[0]).attr("id"));
            })

            /*dataconvert*/
            var data = [
    {
        "key": 1,
        "name": "Folder1",
        "iconCls": "icon-ok"
    },
    {
        "key": 2,
        "pid": 1,
        "name": "File1",
        "checked": true
    },
    {
        "key": 3,
        "pid": 1,
        "name": "Folder2",
        "state": "open"
    },
    {
        "key": 4,
        "pid": 3,
        "name": "File3",
        "attributes": {
            "p1": "value1",
            "p2": "value2"
        },
        "checked": true,
        "iconCls": "icon-reload"
    },
    {
        "key": 8,
        "pid": 3,
        "name": "Async Folder"
    },
    {
        "key": 9,
        "name": "language",
        "state": "closed"
    },
    {
        "key": "j1",
        "pid": 9,
        "name": "Java"
    },
    {
        "key": "j2",
        "pid": 9,
        "name": "C#"
    }
];


            var data1 = { name: "root", children: [
    {
        "key": 1,
        "name": "Folder1",
        "iconCls": "icon-ok"
    },
    {
        "key": 2,
        "pid": 1,
        "name": "File1",
        "checked": true
    },
    {
        "key": 3,
        "pid": 1,
        "name": "Folder2",
        "state": "open"
    },
    {
        "key": 4,
        "pid": 3,
        "name": "File3",
        "attributes": {
            "p1": "value1",
            "p2": "value2"
        },
        "checked": true,
        "iconCls": "icon-reload"
    },
    {
        "key": 8,
        "pid": 3,
        "name": "Async Folder"
    },
    {
        "key": 9,
        "name": "language",
        "state": "closed"
    },
    {
        "key": "j1",
        "pid": 9,
        "name": "Java"
    },
    {
        "key": "j2",
        "pid": 9,
        "name": "C#"
    }
]
            };





            $("#convert").click(function () {
                c = treeDataConvert(data, { idFiled: "key", textFiled: "name", parentField: "pid" });
                console.log(c);
            })



        })
    </script>
</head>
<body>
    <div data-role="page">
    <a href="#" id="btn">click me</a>
    <a href="#" id="check">check</a>
    <a href="#" id="convert">convert</a>
        <div data-role="content" data-theme="b" id="context">
        
       



           
        </div>
    </div>



     <script id="employee-li-tpl" type="text/x-handlebars-template">
            <div data-role="collapsible" id="clParent" data-theme="b" data-content-theme="c">
                <h3>{{name}}</h3>
           
                 
                    {{#recursive children}}

                    {{#if children}}
                <div data-role="collapsible" id="clParent" data-theme="b" data-content-theme="c">
                    <h3>{{name}}</h3>                        
                          {{{recursive children}}}                    


                      </div> 
                      {{else}}
                      
                      
                      <input type="checkbox" name="{{name}}" id="{{key}}" class="custom" />
                    <label for="{{key}}">{{name}}</label>
                     
                       
                      {{/if}}            
                
                    {{/recursive}}
                  
              </div>
            </script>


</body>
</html>
